(function(){function e(e){p=[];for(const[t,n]of Object.entries(e.target.options))n.selected&&n.value&&5===n.value.length&&p.push(n.value)}function t(e){b=e.target.value}function n(e){document.getElementById("legendContainer").replaceChildren();let t=document.createElement("dl");t.setAttribute("class","row text-muted"),t.innerHTML='<dt class="col-xl-3">X-Achse</dt>\n    <dd class="col-xl-9">zeitlicher Verlauf</dd>\n    <dt class="col-xl-3">Y-Achse</dt>\n    <dd class="col-xl-9">Altersgruppen (Einteilung vorgegeben durch den Datenbestand des Robert-Koch-Institus)</dd>\n    <dt class="col-xl-3">Farbschema</dt>\n    <dd class="col-xl-9">7-Tage-Inzidenzwerte (gemeldete COVID-19-Fälle pro 100.000 Personen in der Altersgruppe). Tage ohne Daten werden in der Kategorie „>0–5“ dargestellt.</dd>',document.getElementById("legendContainer").appendChild(t);const n=document.createElement("ul");n.setAttribute("class","list-inline row"),f[b].ranges.forEach(e=>{const t=document.createElement("li");t.setAttribute("class","list-inline-item col-lg-2 col-md-3 col-sm-4 col-6");let a=`>&#8201;${e.min}&#8239;&#8211;&#8201;${isFinite(e.max)?e.max:""}`;t.innerHTML=`<span style="background-color:${e.color};height:16px;width:16px;margin-right:8px;display:inline-block"></span><span style="vertical-align:text-bottom">${a}</span>`,n.appendChild(t)}),document.getElementById("legendContainer").appendChild(n);const a=document.createElement("p");a.setAttribute("class","text-muted");const o=document.createElement("a");o.setAttribute("href",`https://github.com/tschach/covaltvis/blob/main/data/${e}.json`),o.innerText="Datensatz auf Github",a.appendChild(o),document.getElementById("legendContainer").appendChild(a)}function a(e){const t=e.target.value;let n=new Date;switch(t){case"oct2020":u="2020-10-01",y.options.scales.x.time.unit="week";break;case"jan2021":u="2021-01-01",y.options.scales.x.time.unit="week";break;case"last28d":n.setDate(n.getDate()-28),u=i(n),y.options.scales.x.time.unit="day";break;case"last14d":n.setDate(n.getDate()-14),u=i(n),y.options.scales.x.time.unit="day";break;default:u=null,y.options.scales.x.time.unit="week"}}function o(){r(u,g)}function l(e){const t=`data/${e}.json`;return axios.get(t)}function i(e){return e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)}function c(e){const t=`matrixChartCanvas${e}`,n=document.createElement("canvas");return n.setAttribute("id",t),n.setAttribute("style","width:100%;height:33vw;max-height:400px;"),document.getElementById("canvasContainer").appendChild(n),t}function r(e,t){e=e||"2020-01-27",t=t||"2050-12-31",document.getElementById("canvasContainer").replaceChildren(),p.forEach(a=>{let o=c(a);l(a).then(l=>{if(l.data){let c,r=[];for(const[n,a]of Object.entries(l.data))h.forEach(o=>{if(n>=e&&n<=t){let e=0;a.hasOwnProperty(`${o}_7day_cases_per_100k`)&&(e=a[`${o}_7day_cases_per_100k`]),r.push({x:n,y:o,v:e})}c=n});y.data.datasets[0].data=r,y.options.plugins.title.text=m.matrixChartTitle(d[a].name,E(new Date(c)));var i=document.getElementById(o).getContext("2d");new Chart(i,y);n(a)}}).catch(function(e){console.log(e)}).then(function(){}),document.getElementById("resultsContainer").scrollIntoView(!0)})}let s=!1,d={};const m={matrixChartTitle:(e,t)=>`${e}: Corona-7-Tage-Inzidenzwerte nach Altersgruppen, Stand: ${t}`};let u,g,p=[];const h=["total","A00-A04","A05-A14","A15-A34","A35-A59","A60-A79","A80+"],x=["Alle","0–4","5—14","15—34","35—59","60—79","80+"],f={DEFAULT:{label:"Standard-Farbschema",ranges:[{min:0,max:5,color:"#f0f8ff"},{min:5,max:10,color:"#d9e2eb"},{min:10,max:15,color:"#c3ccd7"},{min:15,max:20,color:"#aeb7c3"},{min:20,max:35,color:"#99a2b0"},{min:35,max:50,color:"#868e9d"},{min:50,max:100,color:"#737a8a"},{min:100,max:150,color:"#606678"},{min:150,max:200,color:"#4f5366"},{min:200,max:300,color:"#3e4155"},{min:300,max:600,color:"#2e3044"},{min:600,max:1/0,color:"#1f1f33"}]},TEAL:{label:"Farbschema Türkis",ranges:[{min:0,max:5,color:"#6eeefa"},{min:5,max:35,color:"#63d4e2"},{min:35,max:50,color:"#58bbca"},{min:50,max:100,color:"#4da2b3"},{min:100,max:150,color:"#428b9c"},{min:150,max:200,color:"#387386"},{min:200,max:300,color:"#2d5d71"},{min:300,max:400,color:"#23475c"},{min:400,max:1/0,color:"#193348"}]},RKIHEATMAP:{label:"RKI-Heatmap",ranges:[{min:0,max:5,color:"#d0d1e6"},{min:5,max:10,color:"#a6bedb"},{min:10,max:15,color:"#7cacd1"},{min:15,max:20,color:"#a6c883"},{min:20,max:35,color:"#e5ef25"},{min:35,max:50,color:"#ffe600"},{min:50,max:100,color:"#ff8700"},{min:100,max:150,color:"#ff8700"},{min:150,max:200,color:"#ff3c00"},{min:200,max:300,color:"#f40000"},{min:300,max:600,color:"#bf0000"},{min:600,max:1/0,color:"#8b0000"}]}};let b="DEFAULT";const y={type:"matrix",data:{datasets:[{label:"",data:[],borderWidth:0,backgroundColor:function(e){let t=b||"DEFAULT",n=e.dataset.data[e.dataIndex].v;var a=f[t].ranges[0].color;return f[t].ranges.forEach(e=>{n>e.min&&n<=e.max&&(a=e.color)}),a},height(e){const t=e.chart.chartArea;return t?(t.bottom-t.top)/h.length+1:0},width(e){const t=e.chart.chartArea;return t?(t.right-t.left)/e.chart.scales.x.ticks.length+1:0}}]},options:{animation:{duration:0},layout:{padding:15},plugins:{title:{display:!0,position:"top",align:"center",text:"Corona-7-Tage-Inzidenzwerte je Altersgruppe im Landkreis Görlitz, Stand: ",padding:{top:0,bottom:15},font:{size:18,family:"Monospace"},color:"#666"},tooltip:{displayColors:!1,callbacks:{title:()=>"",label(e){const t=e.dataset.data[e.dataIndex];return[`${E(t.x)}: ${t.v.toString().replace(".",",")}`]}}},legend:{display:!1}},scales:{x:{type:"time",offset:!0,time:{unit:"week",isoWeekday:1,displayFormats:{week:"DD.MM.YY",day:"DD.MM.YY"}},ticks:{font:{size:14,family:"Monospace"},color:"#333",maxRotation:90,minRotation:90,autoSkip:!0,padding:0},grid:{display:!1,drawBorder:!1,tickMarkLength:0},gridLines:{display:!1}},y:{type:"category",position:"left",offset:!0,labels:h,ticks:{display:!0,callback:function(e,t,n){return x[e]},font:{size:14,family:"Monospace"},color:"#333",padding:7.5},grid:{display:!1,drawBorder:!1,tickMarkLength:0},gridLines:{display:!1}}}}};let E=function(e){return moment.isDate(e)||(e=new Date(e)),`${e.getDate()}. ${e.toLocaleString("de-DE",{month:"long"})} ${e.getFullYear()}`};document.getElementById("landkreisSelect").addEventListener("change",t=>e(t)),document.getElementById("updateChartsButton").addEventListener("click",o),document.querySelectorAll("input[name=colorscheme]").forEach(e=>{e.addEventListener("change",e=>t(e))}),document.querySelectorAll("input[name=timeframe]").forEach(e=>{e.addEventListener("change",e=>a(e))}),document.addEventListener("DOMContentLoaded",function(e){moment.locale("de-DE"),axios.get("assets/landkreise.json").then(e=>{e.data&&(d={},Object.keys(e.data).sort(function(t,n){return e.data[t].sorting>e.data[n].sorting?1:e.data[t].sorting<e.data[n].sorting?-1:0}).forEach(function(t){const n=e.data[t];let a=("0000"+t).slice(-5);d[a]=n;const o=document.createElement("option");o.setAttribute("value",a),o.innerText=`${n.name}`,document.getElementById("landkreisSelect").appendChild(o)}),document.getElementById("landkreisSelect").disabled=!1,!0===s&&(p=[Object.keys(d)[0]],r()))})})})();